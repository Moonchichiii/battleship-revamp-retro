services:
  app:
    build:
      context: .
      dockerfile: Dockerfile

    ports:
      - "${PORT:-8000}:8000"

    env_file:
      - .env

    environment:
      ENVIRONMENT: ${ENVIRONMENT:-production}
      DATABASE_URL: ${DATABASE_URL}
      DISABLE_RATE_LIMIT: ${DISABLE_RATE_LIMIT:-1}
      EMAIL_SYNTAX_ONLY: ${EMAIL_SYNTAX_ONLY:-1}
      DB_AUTO_CREATE: ${DB_AUTO_CREATE:-1}
      SECRET_KEY: ${SECRET_KEY}
      GITHUB_CLIENT_ID: ${GITHUB_CLIENT_ID}
      GITHUB_CLIENT_SECRET: ${GITHUB_CLIENT_SECRET}
      GOOGLE_CLIENT_ID: ${GOOGLE_CLIENT_ID}
      GOOGLE_CLIENT_SECRET: ${GOOGLE_CLIENT_SECRET}

    restart: unless-stopped

    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
