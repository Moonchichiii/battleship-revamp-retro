<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1, viewport-fit=cover"
        />
        <meta
            name="description"
            content="Battleship Revamp 2025 â€“ retro terminal-style Battleship you can play in the browser, with AI opponents, scoreboards and endless solo games."
        />
        <link
            rel="icon"
            href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><rect width='16' height='16' fill='%23111'/><path d='M8 2v6h6M8 8l-4 4' stroke='%2339ff14' stroke-width='1.5' stroke-linecap='square'/><circle cx='8' cy='8' r='5' fill='none' stroke='%2339ff14' stroke-width='1'/><circle cx='12' cy='4' r='1' fill='red'/></svg>"
        />
        <title>{% block title %}Battleship Revamp{% endblock %}</title>

        <!-- Styles -->
        <link
            rel="stylesheet"
            href="{{ url_for('static', path='css/retro.css') }}?v={{ STATIC_VERSION }}"
        />

        <meta name="theme-color" content="#05050a" />

        <!-- Scripts -->
        <script src="https://unpkg.com/htmx.org@1.9.10" defer></script>
    </head>
    <body class="retro-crt">
        <header class="site-header" role="banner">
            <div class="container">
                <h1 class="brand">
                    Battleship <span class="blink">_</span>Revamp
                </h1>

                <div id="auth-header" class="auth-bar">
                    {% if current_user %}
                    <span
                        >USER: {{ current_user.display_name or
                        current_user.username }}</span
                    >
                    <button
                        class="btn"
                        hx-post="/auth/logout"
                        hx-target="#main"
                    >
                        Logout
                    </button>
                    {% else %}
                    <span>STATUS: GUEST</span>
                    {% endif %}
                </div>
            </div>
        </header>

        <nav id="primary-nav" class="nav" role="navigation">
            <div class="container">
                <div class="tabs" role="tablist">
                    <button
                        type="button"
                        role="tab"
                        class="tab {% if active_tab=='home' %}is-active{% endif %}"
                        hx-get="{{ url_for('home') }}"
                        hx-target="#main"
                        hx-push-url="true"
                    >
                        Home
                    </button>

                    {% if current_user %}
                    <button
                        type="button"
                        role="tab"
                        class="tab {% if active_tab=='ai' %}is-active{% endif %}"
                        hx-get="{{ url_for('ai_lobby') if url_for else '/ai' }}"
                        hx-target="#main"
                        hx-push-url="true"
                    >
                        AI Opponents
                    </button>
                    {% endif %}

                    <button
                        type="button"
                        role="tab"
                        class="tab {% if active_tab=='game' %}is-active{% endif %}"
                        hx-get="{{ url_for('game') }}"
                        hx-target="#main"
                        hx-push-url="true"
                    >
                        Play Game
                    </button>

                    <button
                        type="button"
                        role="tab"
                        class="tab {% if active_tab=='scores' %}is-active{% endif %}"
                        hx-get="{{ url_for('scores') }}"
                        hx-target="#main"
                        hx-push-url="true"
                    >
                        Scores
                    </button>

                    {% if not current_user %}
                    <button
                        type="button"
                        role="tab"
                        class="tab"
                        hx-get="{{ url_for('signin') }}"
                        hx-target="#main"
                    >
                        Sign In
                    </button>
                    <button
                        type="button"
                        role="tab"
                        class="tab"
                        hx-get="{{ url_for('signup') }}"
                        hx-target="#main"
                    >
                        Register
                    </button>
                    {% endif %}
                </div>
            </div>
        </nav>

        <main id="main" class="container" role="main">
            {% block content %}{% endblock %}
        </main>

        <footer class="site-footer" role="contentinfo">
            <div class="container footer-inner">
                <span class="footer-status">
                    <span class="status-indicator"></span>
                    SYSTEM STATUS: ONLINE
                </span>

                <span class="footer-meta">
                    BATTLESHIP REVAMP 2025 // v0.1.0
                </span>
            </div>
        </footer>

        <script>
            // Tab Highlighting Logic
            document.addEventListener("htmx:afterSwap", function (evt) {
                const path = new URL(
                    evt.detail.pathInfo.requestPath,
                    location.origin
                ).pathname;
                document.querySelectorAll(".tab").forEach((t) => {
                    const hx = t.getAttribute("hx-get");
                    if (hx && new URL(hx, location.origin).pathname === path) {
                        t.classList.add("is-active");
                    } else {
                        t.classList.remove("is-active");
                    }
                });
            });
        </script>
    </body>
</html>
