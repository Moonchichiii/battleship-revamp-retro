<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1, viewport-fit=cover"
        />
        <title>{% block title %}Battleship Revamp{% endblock %}</title>

        <!-- Preconnect -->
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

        <!-- Styles -->
        <link
            rel="stylesheet"
            href="{{ url_for('static', path='css/retro.css') }}"
        />
        <meta name="theme-color" content="#05050a" />

        <!-- Scripts -->
        <script src="https://unpkg.com/htmx.org@1.9.10" defer></script>
    </head>
    <body class="retro-crt">
        <header class="site-header" role="banner">
            <div class="container">
                <h1 class="brand">
                    Battleship <span class="blink">_</span>Revamp
                </h1>

                <!-- Removed inline style, added class .auth-bar -->
                <div id="auth-header" class="auth-bar">
                    {% if current_user %}
                    <span
                        >USER: {{ current_user.display_name or
                        current_user.username }}</span
                    >
                    <button
                        class="btn"
                        hx-post="/auth/logout"
                        hx-target="#main"
                    >
                        Logout
                    </button>
                    {% else %}
                    <span>STATUS: GUEST</span>
                    {% endif %}
                </div>
            </div>
        </header>

        <nav id="primary-nav" class="nav" role="navigation">
            <div class="container">
                <div class="tabs" role="tablist">
                    <!-- Cleaned up Buttons, styling handled by CSS now -->
                    <button
                        type="button"
                        class="tab {% if active_tab=='home' %}is-active{% endif %}"
                        hx-get="{{ url_for('home') }}"
                        hx-target="#main"
                        hx-push-url="true"
                    >
                        Home
                    </button>

                    {% if current_user %}
                    <button
                        type="button"
                        class="tab {% if active_tab=='ai' %}is-active{% endif %}"
                        hx-get="{{ url_for('ai_lobby') if url_for else '/ai' }}"
                        hx-target="#main"
                        hx-push-url="true"
                    >
                        AI Opponents
                    </button>
                    {% endif %}

                    <button
                        type="button"
                        class="tab {% if active_tab=='game' %}is-active{% endif %}"
                        hx-get="{{ url_for('game') }}"
                        hx-target="#main"
                        hx-push-url="true"
                    >
                        Play Game
                    </button>

                    <button
                        type="button"
                        class="tab {% if active_tab=='scores' %}is-active{% endif %}"
                        hx-get="{{ url_for('scores') }}"
                        hx-target="#main"
                        hx-push-url="true"
                    >
                        Scores
                    </button>

                    {% if not current_user %}
                    <button
                        type="button"
                        class="tab"
                        hx-get="{{ url_for('signin') }}"
                        hx-target="#main"
                    >
                        Sign In
                    </button>
                    <button
                        type="button"
                        class="tab"
                        hx-get="{{ url_for('signup') }}"
                        hx-target="#main"
                    >
                        Register
                    </button>
                    {% endif %}
                </div>
            </div>
        </nav>

        <main id="main" class="container" role="main">
            {% block content %}{% endblock %}
        </main>

        <footer class="site-footer">
            <div class="container">
                <p>SYSTEM STATUS: ONLINE // BATTLESHIP REVAMP 2025</p>
            </div>
        </footer>

        <script>
            // Tab Highlighting Logic
            document.addEventListener("htmx:afterSwap", function (evt) {
                const path = new URL(
                    evt.detail.pathInfo.requestPath,
                    location.origin
                ).pathname;
                document.querySelectorAll(".tab").forEach((t) => {
                    const hx = t.getAttribute("hx-get");
                    if (hx && new URL(hx, location.origin).pathname === path) {
                        t.classList.add("is-active");
                    } else {
                        t.classList.remove("is-active");
                    }
                });
            });
        </script>
    </body>
</html>
